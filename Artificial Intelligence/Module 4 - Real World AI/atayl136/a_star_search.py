# The A Star Search algorithm and data to be demoed in streamlit

from typing import List, Tuple, Dict, Callable
from copy import deepcopy
import heapq


full_world = [
['ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾'],
['ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ¾', 'ğŸŒ¾'],
['ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ‹', 'â›°', 'â›°', 'â›°', 'ğŸŒ‹', 'ğŸŒ‹', 'â›°', 'â›°'],
['ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'â›°', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŠ', 'ğŸŠ', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ¾', 'ğŸŒ¾', 'â›°', 'â›°', 'ğŸŒ‹', 'ğŸŒ‹', 'â›°', 'ğŸŒ¾'],
['ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'â›°', 'â›°', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŠ', 'ğŸŠ', 'ğŸŠ', 'ğŸŠ', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'â›°', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ‹', 'â›°', 'ğŸŒ¾'],
['ğŸŒ¾', 'â›°', 'â›°', 'â›°', 'ğŸŒ‹', 'ğŸŒ‹', 'â›°', 'â›°', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŠ', 'ğŸŠ', 'ğŸŠ', 'ğŸŠ', 'ğŸŠ', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'â›°', 'ğŸŒ‹', 'â›°', 'ğŸŒ¾', 'ğŸŒ¾'],
['ğŸŒ¾', 'â›°', 'â›°', 'ğŸŒ‹', 'ğŸŒ‹', 'â›°', 'â›°', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'â›°', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŠ', 'ğŸŠ', 'ğŸŠ', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'â›°', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾'],
['ğŸŒ¾', 'ğŸŒ¾', 'â›°', 'â›°', 'â›°', 'â›°', 'â›°', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'â›°', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŠ', 'ğŸŠ', 'ğŸŠ', 'ğŸŒ¾', 'ğŸŒ¾', 'â›°', 'â›°', 'â›°', 'ğŸŒ¾', 'ğŸŒ¾'],
['ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'â›°', 'â›°', 'â›°', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'â›°', 'â›°', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ¾', 'ğŸŠ', 'ğŸŠ', 'ğŸŒ¾', 'ğŸŒ¾', 'â›°', 'â›°', 'â›°', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾'],
['ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŠ', 'ğŸŠ', 'ğŸŠ', 'ğŸŒ¾', 'ğŸŒ¾', 'â›°', 'â›°', 'â›°', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŠ', 'ğŸŒ¾', 'â›°', 'â›°', 'â›°', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾'],
['ğŸŒ¾', 'ğŸŒ¾', 'ğŸŠ', 'ğŸŠ', 'ğŸŠ', 'ğŸŠ', 'ğŸŠ', 'ğŸŒ¾', 'â›°', 'â›°', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ‹', 'â›°', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'â›°', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ‹', 'â›°', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾'],
['ğŸŒ¾', 'ğŸŠ', 'ğŸŠ', 'ğŸŠ', 'ğŸŠ', 'ğŸŠ', 'ğŸŒ¾', 'ğŸŒ¾', 'â›°', 'ğŸŒ‹', 'ğŸŒ‹', 'â›°', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŠ', 'ğŸŠ', 'ğŸŒ¾', 'ğŸŒ¾', 'â›°', 'ğŸŒ‹', 'ğŸŒ‹', 'â›°', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾'],
['ğŸŠ', 'ğŸŠ', 'ğŸŠ', 'ğŸŠ', 'ğŸŠ', 'ğŸŒ¾', 'ğŸŒ¾', 'â›°', 'â›°', 'ğŸŒ‹', 'ğŸŒ‹', 'â›°', 'ğŸŒ¾', 'ğŸŠ', 'ğŸŠ', 'ğŸŠ', 'ğŸŠ', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'â›°', 'ğŸŒ‹', 'â›°', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾'],
['ğŸŒ¾', 'ğŸŠ', 'ğŸŠ', 'ğŸŠ', 'ğŸŠ', 'ğŸŒ¾', 'ğŸŒ¾', 'â›°', 'ğŸŒ²', 'ğŸŒ²', 'â›°', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŠ', 'ğŸŠ', 'ğŸŠ', 'ğŸŠ', 'ğŸŒ¾', 'ğŸŒ¾', 'â›°', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾'],
['ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ‹', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'â›°', 'â›°', 'â›°', 'â›°', 'ğŸŒ¾', 'ğŸŠ', 'ğŸŠ', 'ğŸŠ', 'ğŸŒ¾', 'ğŸŒ¾', 'â›°', 'ğŸŒ‹', 'â›°', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾'],
['ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ‹', 'â›°', 'â›°', 'ğŸŒ¾', 'ğŸŠ', 'ğŸŒ¾', 'â›°', 'ğŸŒ‹', 'ğŸŒ‹', 'â›°', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾'],
['ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾'],
['ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾'],
['ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'â›°', 'â›°', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾'],
['ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŠ', 'ğŸŠ', 'ğŸŠ', 'ğŸŠ'],
['ğŸŒ¾', 'ğŸŒ¾', 'â›°', 'â›°', 'â›°', 'â›°', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ¾', 'ğŸŒ‹', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŠ', 'ğŸŠ', 'ğŸŠ', 'ğŸŠ', 'ğŸŠ', 'ğŸŠ', 'ğŸŠ'],
['ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'â›°', 'â›°', 'â›°', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŠ', 'ğŸŠ', 'ğŸŠ', 'ğŸŠ', 'ğŸŠ', 'ğŸŠ', 'ğŸŠ'],
['ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'â›°', 'â›°', 'â›°', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'â›°', 'â›°', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŠ', 'ğŸŠ', 'ğŸŠ', 'ğŸŠ', 'ğŸŠ', 'ğŸŠ'],
['ğŸŒ¾', 'â›°', 'â›°', 'ğŸŒ¾', 'ğŸŒ¾', 'â›°', 'â›°', 'â›°', 'â›°', 'â›°', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'â›°', 'â›°', 'ğŸŒ‹', 'ğŸŒ‹', 'â›°', 'â›°', 'ğŸŒ¾', 'ğŸŠ', 'ğŸŠ', 'ğŸŠ', 'ğŸŠ', 'ğŸŠ'],
['â›°', 'ğŸŒ‹', 'â›°', 'â›°', 'â›°', 'â›°', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ‹', 'â›°', 'â›°', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ¾', 'ğŸŒ‹', 'ğŸŒ‹', 'â›°', 'â›°', 'ğŸŠ', 'ğŸŠ', 'ğŸŠ', 'ğŸŠ'],
['â›°', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ‹', 'â›°', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'â›°', 'â›°', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ‹', 'â›°', 'â›°', 'â›°', 'â›°', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŒ‹', 'ğŸŠ', 'ğŸŠ', 'ğŸŠ', 'ğŸŠ'],
['â›°', 'â›°', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'â›°', 'â›°', 'â›°', 'â›°', 'â›°', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'â›°', 'â›°', 'â›°', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾']
]


small_world = [
    ['ğŸŒ¾', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²'],
    ['ğŸŒ¾', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²'],
    ['ğŸŒ¾', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²'],
    ['ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾', 'ğŸŒ¾'],
    ['ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ¾'],
    ['ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ¾'],
    ['ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ²', 'ğŸŒ¾']
]

MOVES = [(0,-1), (1,0), (0,1), (-1,0)]

COSTS = { 'ğŸŒ¾': 1, 'ğŸŒ²': 3, 'â›°': 5, 'ğŸŠ': 7 } 



def heuristic(node, goal):
    # Manhattan distance heuristic
    return (abs(node[0] - goal[0]) + abs(node[1] - goal[1]))

# Helper function

def reconstruct_path(came_from, current_node):
    path = [current_node]
    while current_node in came_from:
        current_node = came_from[current_node]
        path.append(current_node)
    path.reverse()
    return path



def a_star_search(world, start, goal, costs, moves, heuristic):
    frontier = [(heuristic(start, goal), start)]  # Priority queue (f_score, position)
    came_from = {}  # For tracking the path
    g_score = {start: 0}  # Cost from start to node
    f_score = {start: heuristic(start, goal)}  # f(n) = g(n) + h(n)
    explored = {}  # Dictionary to track fully explored nodes and their g_scores

    while frontier:
        current = heapq.heappop(frontier)[1]

        if current == goal:
            return reconstruct_path(came_from, current)

        for move in moves:
            neighbor = (current[0] + move[0], current[1] + move[1])

            # Check if neighbor is within bounds
            if 0 <= neighbor[1] < len(world) and 0 <= neighbor[0] < len(world[0]):
                terrain_type = world[neighbor[1]][neighbor[0]]
                if terrain_type not in costs:
                    continue

                new_g_score = g_score[current] + costs[terrain_type]

                # Skip if neighbor is the last node in came_from (the node just visited)
                if came_from.get(current) == neighbor:
                    continue

                # If a valid neighbor is found, add it to the frontier
                # uses g_score list as a proxy to check the frontier
                if neighbor not in explored and (neighbor not in g_score or new_g_score < g_score[neighbor]):
                    g_score[neighbor] = new_g_score
                    f_score[neighbor] = new_g_score + heuristic(neighbor, goal)
                    heapq.heappush(frontier, (f_score[neighbor], neighbor))
                    # Overwrite the entry in came_from
                    came_from[neighbor] = current

        # Mark the current node as fully explored
        explored[current] = g_score[current]

    # If the frontier is empty and goal was not reached
    print("Frontier empty, no path found.")

    return []

def pretty_print_path(world: List[List[str]], path: List[Tuple[int, int]], 
                      start: Tuple[int, int], goal: Tuple[int, int], costs: Dict[str, int]) -> int:
    total_cost = 0
    world_copy = deepcopy(world)
    
    # Determine the direction of the first move from start
    if len(path) > 1:
        first_move = path[1]
        if first_move[0] > start[0]:
            world_copy[start[1]][start[0]] = 'â©'
        elif first_move[1] > start[1]:
            world_copy[start[1]][start[0]] = 'â¬'
        elif first_move[0] < start[0]:
            world_copy[start[1]][start[0]] = 'âª'
        elif first_move[1] < start[1]:
            world_copy[start[1]][start[0]] = 'â«'
    
    # Replace the rest of the path with direction symbols
    for i in range(1, len(path)):
        position = path[i]
        if position == goal:
            world_copy[position[1]][position[0]] = 'ğŸ'
        else:
            prev_position = path[i-1]
            if position[0] > prev_position[0]:
                world_copy[position[1]][position[0]] = 'â©'
            elif position[1] > prev_position[1]:
                world_copy[position[1]][position[0]] = 'â¬'
            elif position[0] < prev_position[0]:
                world_copy[position[1]][position[0]] = 'âª'
            elif position[1] < prev_position[1]:
                world_copy[position[1]][position[0]] = 'â«'

        total_cost += costs[world[position[1]][position[0]]]
    
    # Print the world with the path
    for line in world_copy:
        print("".join(line))
    
    return total_cost

